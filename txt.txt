//quay khoign ·∫£nh
<!DOCTYPE html>
<html>

<head>
    <meta name="screen-orientation" content="portrait">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />
    <title>FIT_TE</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css">
    <link rel="stylesheet" type="text/css" href="css/wall.css">
    <style type="text/css">
        body,
        html {
            width: 100%;
            height: 100%;
        }

        .alert-mask {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }

        .alert-box {
            background: #fff;
            padding: 20px 30px;
            border-radius: 12px;
            text-align: center;
            min-width: 260px;
        }

        .alert-box h3 {
            margin-bottom: 10px;
            color: #e53935;
        }

        .alert-box button {
            margin-top: 15px;
            padding: 6px 20px;
            border: none;
            background: #2196f3;
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
        }

        .result {
            position: absolute;
            height: 320px;
            width: 100%;
            left: 0;
            top: 50%;
            margin-top: -160px;
            text-align: center;
            padding: 10px;
            display: none;
        }

        /* ===== TRANG CH·ª¶ ===== */
        #home-screen {
            position: fixed;
            inset: 0;
            z-index: 9999;

        }

        #home-screen img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: inherit;
        }


        .lottery-controls .pure-button {
            width: 170px;
            height: 85px;
            border-radius: 16px;
            border: none;
            color: #fff;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
            transition: all 0.25s ease;
        }

        #myCanvas {
            /* display: block; */
        }


        /* Text */
        .lottery-controls .vi {
            display: block;
            font-size: 18px;
            font-weight: bold;
        }

        .lottery-controls .cn {
            display: block;
            font-size: 14px;
            opacity: 0.85;
        }

        /* M√†u */
        .lottery-controls .btn-start {
            background: linear-gradient(135deg, #ff5722, #ff9800);
        }

        .lottery-controls .btn-stop {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
        }

        .lottery-controls .btn-reset {
            background: linear-gradient(135deg, #2196f3, #03a9f4);
        }

        /* Disable */
        .lottery-controls .pure-button:disabled {
            background: #9e9e9e;
            cursor: not-allowed;
            box-shadow: none;
        }


        .result span {
            display: inline-block;
            font-size: 25px;
            /* width: 150px; */
            background: #fff;
            line-height: 30px;
            color: #000;
            margin: 5px;
            border-radius: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.8);
            padding: 10px 10px;
        }

        button,
        input,
        optgroup,
        select,
        textarea {
            color: inherit;
            font: inherit;
            margin: 0;
            border: none;
        }

        button {
            overflow: visible;
        }

        button,
        select {
            text-transform: none;
        }

        button,
        html input[type=button],
        input[type=reset],
        input[type=submit] {
            -webkit-appearance: button;
            cursor: pointer;
        }

        .pure-button {
            display: inline-block;
            zoom: 1;
            line-height: normal;
            white-space: nowrap;
            vertical-align: middle;
            text-align: center;
            cursor: pointer;
            -webkit-user-drag: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

        .pure-button {
            font-family: inherit;
            font-size: 100%;
            padding: .5em 1em;
            color: #444;
            color: rgba(0, 0, 0, .8);
            border: 0 rgba(0, 0, 0, 0);
            background-color: #E6E6E6;
            text-decoration: none;
            border-radius: 15px;
        }

        .pure-button:focus {
            outline: 0
        }

        .pure-button-hover,
        .pure-button:hover,
        .pure-button:focus {
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00000000', endColorstr='#1a000000', GradientType=0);
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(40%, rgba(0, 0, 0, .05)), to(rgba(0, 0, 0, .1)));
            background-image: -webkit-linear-gradient(transparent, rgba(0, 0, 0, .05) 40%, rgba(0, 0, 0, .1));
            background-image: -moz-linear-gradient(top, rgba(0, 0, 0, .05) 0, rgba(0, 0, 0, .1));
            background-image: -o-linear-gradient(transparent, rgba(0, 0, 0, .05) 40%, rgba(0, 0, 0, .1));
            background-image: linear-gradient(transparent, rgba(0, 0, 0, .05) 40%, rgba(0, 0, 0, .1));
        }

        .button-success,
        .button-error,
        .button-warning,
        .button-secondary {
            color: white;
            border-radius: 4px;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
        }

        .button-success {
            background: rgb(28, 184, 65);
        }

        .button-error {
            background: rgb(202, 60, 60);
        }

        .button-warning {
            background: rgb(223, 117, 20);
        }

        .button-secondary {
            background: rgb(66, 184, 221);
        }

        .tools {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;

            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 20px;
        }

        /* B√äN TR√ÅI */
        .tools-left {
            display: flex;
            /* gap: 10px; */
            flex-wrap: wrap;
            max-width: 50%;
        }

        /* B√äN PH·∫¢I */
        .tools-right {
            display: flex;
            flex-direction: inherit;
            gap: 12px;
            align-items: center;
        }

        /* =========================
   FIX HOVER B·ªä M·ªú N√öT CH√çNH
   ========================= */

        /* Ghi ƒë√® hover m·∫∑c ƒë·ªãnh c·ªßa pure-button */
        .lottery-controls .pure-button:hover,
        .lottery-controls .pure-button:focus {
            background-image: none !important;
            filter: none !important;
            opacity: 1 !important;
            transform: translateY(-2px) scale(1.03);
        }

        /* Hi·ªáu ·ª©ng s√°ng theo t·ª´ng n√∫t */
        .lottery-controls .btn-start:hover {
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.9);
        }

        .lottery-controls .btn-stop:hover {
            box-shadow: 0 0 20px rgba(211, 47, 47, 0.9);
        }

        .lottery-controls .btn-reset:hover {
            box-shadow: 0 0 20px rgba(3, 169, 244, 0.9);
        }



        .tools .pure-button {
            display: inline-block;
            margin: 5px;
            /* padding: 10px 0; */
            text-align: center;
            width: 150px;
            font-size: 13px;
        }

        .mask {
            -webkit-filter: blur(5px);
            filter: blur(5px);
        }

        #main {
            position: relative;
            width: 100%;
            height: 100%;

            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-btn {
            position: fixed;
            top: 5px;
            right: 1px;
            z-index: 20000;
        }
    </style>
</head>

<body>
    <!-- ===== TRANG CH·ª¶ ===== -->
    <div id="home-screen">
        <img src="img/home.png">
    </div>



    <div id="customAlert" class="alert-mask" style="display:none">
        <div class="alert-box">
            <h3>Th√¥ng b√°o</h3>
            <p>Gi·∫£i n√†y ƒë√£ quay xongÔºÅ<br>ËØ•Â•ñÈ°πÂ∑≤ÊäΩÂÆåÔºÅ</p>
            <button onclick="closeAlert()">OK</button>
        </div>
    </div>

    <div id="customResetAlert" class="alert-mask" style="display:none">
        <div class="alert-box">
            <h3>Th√¥ng b√°o</h3>
            <p style="font-size:18px; font-weight:bold;">
                B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën c√†i l·∫°i kh√¥ng?<br>
                <span style="font-size:14px; font-weight:normal;">
                    Á°ÆÂÆöË¶ÅÈáçÁΩÆ‰πàÔºü
                </span><br>
                T·∫•t c·∫£ l·ªãch s·ª≠ quay tr∆∞·ªõc ƒë√≥ s·∫Ω b·ªã x√≥a!
            </p>
            <button onclick="confirmReset()">OK</button>
            <button onclick="closeResetAlert()" style="margin-left:10px;">H·ªßy</button>
        </div>
    </div>
    <!-- Th√™m nh·∫°c n·ªÅn t·∫°i ƒë√¢y -->
    <audio id="bgMusic" src="audio/tatNien2024(30s).mp3" loop></audio>


    <div id="main" class="wall">

    </div>
    <div id="result" class="result">
    </div>
    <div id="tools" class="tools">
        <!-- B√äN TR√ÅI: C√ÅC GI·∫¢I -->
        <div class="tools-left">
            <button v-for="(item, index) in btns" @click="onClick(item, index)" class="pure-button"
                :disabled="item.done" :class="{
                'button-error': selectedIndex === index,
                'button-secondary': item.done
            }">
                {{ item.label }}<br>
                ({{ item.done ? 0 : item.value }})
            </button>
        </div>

        <!-- B√äN PH·∫¢I: N√öT ƒêI·ªÄU KHI·ªÇN -->
        <div class="tools-right lottery-controls">
            <button class="pure-button btn-main" @click.stop="toggle" :class="running ? 'btn-stop' : 'btn-start'">
                <span class="vi">{{ running ? 'D·ª™NG' : 'B·∫ÆT ƒê·∫¶U' }}</span>
                <span class="cn">{{ running ? 'ÂÅúÊ≠¢' : 'ÂºÄÂßã' }}</span>
            </button>

            <button class="pure-button btn-reset" @click.stop="showResetAlert">
                <span class="vi">C√ÄI L·∫†I</span>
                <span class="cn">ÈáçÁΩÆ</span>
            </button>


        </div>
    </div>

    <script type="text/javascript" src="js/zepto.js"></script>
    <script type="text/javascript" src="js/vue.js"></script>
    <script type="text/javascript" src="js/tagcanvas.js"></script>
    <script type="text/javascript" src="js/member.js"></script>
    <script>
        document.addEventListener('keydown', function (e) {
            if (e.code === 'Enter' || e.code === 'Space') {
                const home = document.getElementById('home-screen');
                if (home && home.style.display !== 'none') {
                    home.style.display = 'none';
                    return;
                }

                const app = window.appVue;

                // N·∫øu ch∆∞a ch·ªçn gi·∫£i n√†o v√† ch∆∞a ch·∫°y ‚Üí m·∫∑c ƒë·ªãnh 1 ng∆∞·ªùi
                if (!app.running && (app.selectedIndex === null || app.selected === 0)) {
                    app.selected = 1;
                    app.selectedIndex = null; // ƒë√°nh d·∫•u kh√¥ng ph·∫£i gi·∫£i c·ªë ƒë·ªãnh
                }

                // G·ªçi toggle() ƒë·ªÉ Start/Stop, logic s·∫Ω x·ª≠ l√Ω c·∫£ 2 tr∆∞·ªùng h·ª£p
                app.toggle();
            }
        });



    </script>


    <script type="text/javascript">
        (function () {
            var choosed = JSON.parse(localStorage.getItem('choosed')) || {};
            var bgMusic = document.getElementById('bgMusic'); // üéµ nh·∫°c n·ªÅn

            console.log(choosed);
            var speed = function () {
                return [0.1 * Math.random() + 0.01, -(0.1 * Math.random() + 0.01)];
            };
            var getKey = function (item) {
                return item.name + '-' + item.phone;
            };
            var createHTML = function () {
                var html = ['<ul>'];
                member.forEach(function (item, index) {
                    item.index = index;
                    var key = getKey(item);
                    var color = choosed[key] ? 'yellow' : 'white';
                    html.push('<li><a href="#" style="color: ' + color + ';">' + item.name + '</a></li>');
                });
                html.push('</ul>');
                return html.join('');
            };
            // var lottery = function (count) {
            //     var list = canvas.getElementsByTagName('a');
            //     var color = 'yellow';
            //     var ret = member
            //         .filter(function (m, index) {
            //             m.index = index;
            //             return !choosed[getKey(m)];
            //         })
            //         .map(function (m) {
            //             return Object.assign({
            //                 score: Math.random()
            //             }, m);
            //         })
            //         .sort(function (a, b) {
            //             return a.score - b.score;
            //         })
            //         .slice(0, count)
            //         .map(function (m) {
            //             choosed[getKey(m)] = 1;
            //             list[m.index].style.color = color;
            //             return m.name + '<br/>' + m.phone;
            //         });
            //     localStorage.setItem('choosed', JSON.stringify(choosed));
            //     return ret;
            // };
            //tuanlg

            var lottery = function (count) {
                var list = canvas.getElementsByTagName('a');
                var color = 'yellow';

                // L·ªçc nh·ªØng ng∆∞·ªùi ch∆∞a tr√∫ng
                var remaining = member.filter(m => !choosed[getKey(m)]);

                // Random ng·∫´u nhi√™n v√† ch·ªçn count ng∆∞·ªùi
                var ret = remaining
                    .map(m => Object.assign({ score: Math.random() }, m))
                    .sort((a, b) => a.score - b.score)
                    .slice(0, count)
                    .map(m => {
                        choosed[getKey(m)] = 1; // ƒë√°nh d·∫•u ƒë√£ tr√∫ng
                        list[m.index].style.color = color; // highlight
                        return m;
                    });

                localStorage.setItem('choosed', JSON.stringify(choosed));
                return ret.map(m => m.name + '<br/>' + m.phone);
            };


            var canvas = document.createElement('canvas');
            canvas.id = 'myCanvas';
            canvas.width = document.body.offsetWidth;
            canvas.height = document.body.offsetHeight;

            document.getElementById('main').appendChild(canvas);
            window.appVue = new Vue({
                el: '#tools',
                data: {
                    selected: 1,
                    selectedIndex: null,   // üëà th√™m d√≤ng n√†y
                    running: false,
                    showResult: false,
                    currentPrizeIndex: 0, // Gi·∫£i hi·ªán t·∫°i ƒëang ch·ªù quay
                    highlightInterval: null,
                    btns: [
                        { label: 'GI·∫¢I NH·∫§T', value: 5, done: false },
                        { label: 'GI·∫¢I NH√å', value: 10, done: false },
                        { label: 'GI·∫¢I BA', value: 10, done: false },
                        { label: 'GI·∫¢I KHUY·∫æN KH√çCH', value: 20, done: false },
                        { label: 'GI·∫¢I KH√çCH L·ªÜ BU', value: 10, done: false }
                    ]

                }
                ,
                mounted() {
                    canvas.innerHTML = createHTML();
                    TagCanvas.Start('myCanvas', '', {
                        textColour: null,
                        initial: speed(),
                        dragControl: 1,
                        textHeight: 14
                    });
                },
                methods: {
                    showResetAlert: function () {
                        showResetAlert();
                    },
                    onClick: function (item, index) {
                        if (item.done) return;

                        $('#result').css('display', 'none');
                        $('#main').removeClass('mask');

                        this.selected = item.value;
                        this.selectedIndex = index;
                    }

                    ,
                    toggle: function () {
                        // N·∫øu ch∆∞a ch·ªçn gi·∫£i n√†o, m·∫∑c ƒë·ªãnh 1 ng∆∞·ªùi
                        if (!this.running && this.selected === 0) {
                            this.selected = 1;
                            this.selectedIndex = null; // ƒë√°nh d·∫•u kh√¥ng ph·∫£i gi·∫£i c·ª• th·ªÉ
                        }

                        if (this.running) {
                            // D·ª´ng quay
                            TagCanvas.SetSpeed('myCanvas', speed());
                            // üéµ D·ª´ng nh·∫°c khi d·ª´ng quay
                            bgMusic.pause();
                            var ret = lottery(this.selected);

                            // N·∫øu gi·∫£i ƒë∆∞·ª£c ch·ªçn, ƒë√°nh d·∫•u done
                            let prizeLabel = this.selectedIndex !== null ? this.btns[this.selectedIndex].label : 'Ph·∫ßn th∆∞·ªüng';

                            if (this.selectedIndex !== null) {
                                this.btns[this.selectedIndex].done = true;
                                this.btns[this.selectedIndex].value = 0;
                                this.selected = 0;
                            }

                            if (ret.length === 0) {
                                $('#result').css('display', 'block').html('<span>Â∑≤ÊäΩÂÆå</span>');
                                return;
                            }

                            $('#result')
                                .show()
                                .html('<span>' + ret.join('</span><span>') + '</span>');

                            this.showResult = true;
                            TagCanvas.Reload('myCanvas');

                            setTimeout(() => {
                                var prizeLabel = this.selectedIndex !== null ? this.btns[this.selectedIndex].label : "GI·∫¢I PH·∫¶N TH∆Ø·ªûNG";
                                // t√°ch <br/> th√†nh [T√™n, M√£]
                                var winners = ret.map(item => item.split('<br/>'));
                                localStorage.setItem(new Date().toString(), JSON.stringify({
                                    prize: prizeLabel,
                                    winners: winners
                                }));
                                $('#main').addClass('mask');
                            }, 300);


                        } else {
                            // B·∫Øt ƒë·∫ßu quay ‚Üí highlight lu√¢n phi√™n t·∫•t c·∫£ c√°c th√†nh vi√™n
                            $('#result').css('display', 'none');
                            $('#main').removeClass('mask');

                            var list = canvas.getElementsByTagName('a');
                            var i = 0;
                            var interval = setInterval(() => {
                                list.forEach(a => a.style.color = 'white'); // reset m√†u
                                list[i % list.length].style.color = 'orange'; // highlight t·ª´ng ng∆∞·ªùi
                                i++;
                            }, 50);
                            // üéµ Ph√°t nh·∫°c n·ªÅn khi b·∫Øt ƒë·∫ßu quay
                            bgMusic.currentTime = 0;
                            bgMusic.play();
                            this.highlightInterval = interval; // l∆∞u interval ƒë·ªÉ d·ª´ng sau
                            TagCanvas.SetSpeed('myCanvas', [5, 1]); // qu·∫£ c·∫ßu quay
                        }

                        //tuanlg
                        // } else {
                        //     // B·∫Øt ƒë·∫ßu quay
                        //     $('#result').css('display', 'none');
                        //     $('#main').removeClass('mask');
                        //     TagCanvas.SetSpeed('myCanvas', [5, 1]); // qu·∫£ c·∫ßu quay
                        // }
                        // D·ª´ng highlight lu√¢n phi√™n n·∫øu ƒëang ch·∫°y
                        if (!this.running && this.highlightInterval) {
                            clearInterval(this.highlightInterval);
                            this.highlightInterval = null;
                        }

                        this.running = !this.running; // chuy·ªÉn tr·∫°ng th√°i
                    }

                }
            });
        })();
    </script>
    <script>
        document.addEventListener('click', function (e) {
            const result = document.getElementById('result');
            const tools = document.getElementById('tools');

            // N·∫øu ƒëang hi·ªán k·∫øt qu·∫£
            if (result.style.display === 'block') {

                // N·∫øu click KH√îNG n·∫±m trong n√∫t ƒëi·ªÅu khi·ªÉn
                if (!tools.contains(e.target)) {
                    result.style.display = 'none';
                    document.getElementById('main').classList.remove('mask');
                }
            }
        });
    </script>

    <script>
        function showAlert() {
            document.getElementById('customAlert').style.display = 'flex';
        }

        function closeAlert() {
            document.getElementById('customAlert').style.display = 'none';
        }
        function showResetAlert() {
            document.getElementById('customResetAlert').style.display = 'flex';
        }
        function closeResetAlert() {
            document.getElementById('customResetAlert').style.display = 'none';
        }
        function confirmReset() {
            localStorage.clear();
            location.reload(true);
        }
    </script>
    <!-- LINK XEM K·∫æT QU·∫¢ -->
    <div class="result-btn">
        <a href="./result.html" target="_blank">Ëé∑Â•ñÂêçÂçï</a>
    </div>

</body>

</html>